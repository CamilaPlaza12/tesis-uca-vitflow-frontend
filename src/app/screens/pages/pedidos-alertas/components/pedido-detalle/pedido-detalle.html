<div class="card" *ngIf="pedido">
  <div class="top">
    <h3>Detalle del pedido</h3>
    <button class="icon-btn" type="button" (click)="close()">✕</button>
  </div>

  <div class="body">
    <!-- VIEW MODE -->
    <div class="meta" *ngIf="!editMode">
      <div class="row">
        <span class="k">Fecha y hora</span>
        <span class="v">{{ pedido.datetime_local }}</span>
      </div>

      <div class="row">
        <span class="k">Servicio</span>
        <span class="v">{{ pedido.hospital_unit }}</span>
      </div>

      <div class="row">
        <span class="k">Componente</span>
        <span class="v">{{ pedido.component }} {{ pedido.blood_group }}</span>
      </div>

      <div class="row">
        <span class="k">Cantidad solicitada</span>
        <span class="v">{{ pedido.requested_ml }} unidades</span>
      </div>

      <div class="row">
        <span class="k">Cantidad obtenida</span>
        <span class="v">{{ pedido.collected_ml }} unidades</span>
      </div>

      <div class="row">
        <span class="k">Prioridad</span>
        <span class="v">{{ prioridadLabel(pedido.priority) }}</span>
      </div>

      <div class="row">
        <span class="k">Estado actual</span>
        <span class="v">{{ estadoLabel(pedido.status) }}</span>
      </div>

      <div class="row">
        <span class="k">Solicitado por</span>
        <span class="v">{{ pedido.requested_by }}</span>
      </div>

      <div class="row" *ngIf="pedido.comments">
        <span class="k">Comentarios</span>
        <span class="v">{{ pedido.comments }}</span>
      </div>
    </div>

    <!-- EDIT MODE -->
    <div class="meta" *ngIf="editMode && draft">
      <div class="row">
        <span class="k">Servicio</span>
        <div class="v">
          <input
            class="field"
            list="serviciosList"
            [(ngModel)]="draft.hospital_unit"
          />
          <datalist id="serviciosList">
            <option *ngFor="let s of servicios" [value]="s"></option>
          </datalist>
        </div>
      </div>
      <div class="row">
        <span class="k">Cantidad solicitada</span>
        <div class="v readonly">{{ draft.requested_ml }} unidades</div>
      </div>

      <div class="row">
        <span class="k">Cantidad obtenida</span>
        <div class="v readonly">{{ draft.collected_ml }} unidades</div>
      </div>

      <!-- PRIORIDAD -->
      <div class="row">
        <span class="k">Prioridad</span>
        <div class="v">
          <div class="dropdown">
            <button
              class="drop-btn"
              type="button"
              (click)="toggleDropdown('prioridad')"
            >
              {{ prioridadLabel(draft.priority) }} ▾
            </button>

            <div class="menu" *ngIf="dropdownOpen.prioridad">
              <button
                class="opt"
                *ngFor="let p of prioridades"
                (click)="selectPrioridad(p)"
              >
                {{ prioridadLabel(p) }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ESTADO -->
      <div class="row">
        <span class="k">Estado actual</span>
        <div class="v">
          <div class="dropdown">
            <button
              class="drop-btn"
              type="button"
              (click)="toggleDropdown('estado')"
            >
              {{ estadoLabel(draft.status) }} ▾
            </button>

            <div class="menu" *ngIf="dropdownOpen.estado">
              <button
                class="opt"
                *ngFor="let e of estados"
                (click)="selectEstado(e)"
              >
                {{ estadoLabel(e) }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <span class="k">Comentarios</span>
        <div class="v">
          <textarea
            class="field textarea"
            rows="3"
            [(ngModel)]="draft.comments"
          ></textarea>
        </div>
      </div>

      <div class="error" *ngIf="errorMsg">{{ errorMsg }}</div>
    </div>
  </div>

  <div class="actions" *ngIf="!editMode">
    <button class="btn-ghost" type="button" (click)="empezarEdicion()">
      Editar
    </button>
  </div>

  <div class="actions edit-actions" *ngIf="editMode">
    <button class="btn-soft" type="button" (click)="guardar()">Guardar</button>
    <button class="btn-ghost" type="button" (click)="cancelarEdicion()">
      Cancelar
    </button>
  </div>
</div>
