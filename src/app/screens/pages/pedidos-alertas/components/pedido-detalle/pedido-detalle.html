<div class="card" *ngIf="pedido">
  <div class="top">
    <h3>Detalle del pedido</h3>
    <button class="icon-btn" type="button" (click)="close()">✕</button>
  </div>

  <div class="body">
    <!-- VIEW MODE -->
    <div class="meta" *ngIf="!editMode">
      <div class="row">
        <span class="k">Fecha y hora</span>
        <span class="v">{{ pedido.fechaHora }}</span>
      </div>
      <div class="row">
        <span class="k">Servicio</span>
        <span class="v">{{ pedido.servicio }}</span>
      </div>
      <div class="row">
        <span class="k">Componente</span>
        <span class="v">{{ pedido.componente }} {{ pedido.grupoSanguineo }}</span>
      </div>
      <div class="row">
        <span class="k">Cantidad solicitada</span>
        <span class="v">{{ pedido.cantidadSolicitadaMl }} unidades</span>
      </div>
      <div class="row">
        <span class="k">Cantidad obtenida</span>
        <span class="v">{{ pedido.cantidadObtenidaMl }} unidades</span>
      </div>
      <div class="row">
        <span class="k">Prioridad</span>
        <span class="v">{{ prioridadLabel(pedido.prioridad) }}</span>
      </div>
      <div class="row">
        <span class="k">Estado actual</span>
        <span class="v">{{ estadoLabel(pedido.estado) }}</span>
      </div>
      <div class="row">
        <span class="k">Solicitado por</span>
        <span class="v">{{ pedido.solicitadoPor }}</span>
      </div>

      <div class="row" *ngIf="pedido.comentarios">
        <span class="k">Comentarios</span>
        <span class="v">{{ pedido.comentarios }}</span>
      </div>
    </div>

    <!-- EDIT MODE -->
    <div class="meta" *ngIf="editMode && draft">
      <div class="row">
        <span class="k">Servicio</span>
        <div class="v">
          <input class="field" list="serviciosList" [(ngModel)]="draft.servicio" />
          <datalist id="serviciosList">
            <option *ngFor="let s of servicios" [value]="s"></option>
          </datalist>
        </div>
      </div>

      <div class="row">
        <span class="k">Cantidad</span>
        <div class="v">
          <input class="field" type="number" min="1" [(ngModel)]="draft.cantidadSolicitadaMl" />
        </div>
      </div>

      <div class="row">
        <span class="k">Cantidad</span>
        <div class="v">
          <input class="field" type="number" min="1" [(ngModel)]="draft.cantidadObtenidaMl" />
        </div>
      </div>

      <!-- PRIORIDAD: dropdown custom -->
      <div class="row">
        <span class="k">Prioridad</span>
        <div class="v">
          <div class="dropdown">
            <button
              class="drop-btn"
              type="button"
              (click)="toggleDropdown('prioridad')"
              [class.open]="dropdownOpen.prioridad"
            >
              <span>{{ prioridadLabel(draft.prioridad) }}</span>
              <span class="chev">▾</span>
            </button>

            <div class="menu" *ngIf="dropdownOpen.prioridad">
              <button
                class="opt"
                type="button"
                *ngFor="let p of prioridades"
                (click)="selectPrioridad(p)"
                [class.active]="p === draft.prioridad"
              >
                {{ prioridadLabel(p) }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ESTADO: dropdown custom -->
      <div class="row">
        <span class="k">Estado actual</span>
        <div class="v">
          <div class="dropdown">
            <button
              class="drop-btn"
              type="button"
              (click)="toggleDropdown('estado')"
              [class.open]="dropdownOpen.estado"
            >
              <span>{{ estadoLabel(draft.estado) }}</span>
              <span class="chev">▾</span>
            </button>

            <div class="menu" *ngIf="dropdownOpen.estado">
              <button
                class="opt"
                type="button"
                *ngFor="let e of estados"
                (click)="selectEstado(e)"
                [class.active]="e === draft.estado"
              >
                {{ estadoLabel(e) }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <span class="k">Comentarios</span>
        <div class="v">
          <textarea class="field textarea" rows="3" [(ngModel)]="draft.comentarios"></textarea>
        </div>
      </div>

      <div class="error" *ngIf="errorMsg">{{ errorMsg }}</div>
    </div>
  </div>

  <div class="actions" *ngIf="!editMode">
    <button class="btn-danger" type="button">Cancelar pedido</button>
    <button class="btn-ghost" type="button" (click)="empezarEdicion()">Editar</button>
  </div>

  <div class="actions edit-actions" *ngIf="editMode">
    <button class="btn-soft" type="button" (click)="guardar()">Guardar</button>
    <button class="btn-ghost" type="button" (click)="cancelarEdicion()">Cancelar</button>
  </div>
</div>
