<div class="page">
  <header class="header">
    <div class="header__left">
      <h1>Turnos de donación</h1>
      <p>Controlá la agenda de donaciones del hospital.</p>
    </div>

    <div class="header__right">
      <div class="date">
        Hoy – {{ today | date: 'dd/MM/yyyy' }}
      </div>
    </div>
  </header>

  <section class="layout" [class.with-detail]="!!turnoSeleccionado">
    <div class="left">
      <app-turnos-table
        [turnos]="turnos"
        [turnoSeleccionadoId]="turnoSeleccionado?.id ?? null"
        (selectTurno)="onSelectTurno($event)"
      ></app-turnos-table>
    </div>

    <div class="right" *ngIf="turnoSeleccionado as t">
      <div class="detail-card">
        <button class="close" type="button" (click)="turnoSeleccionado = null" aria-label="Cerrar detalle">
          ✕
        </button>

        <h3>Detalle del turno</h3>

        <div class="kv">
          <div><span>Donante</span><b>{{ t.nombreDonante }}</b></div>
          <div><span>Tipo de donación</span><b>{{ t.tipoDonacion }}</b></div>
          <div><span>Fecha</span><b>{{ t.fecha }}</b></div>
          <div><span>Hora</span><b>{{ t.hora }}</b></div>
          <div><span>Estado</span><b>{{ t.estado }}</b></div>
          <div><span>Pedido asociado</span><b>#{{ t.pedidoId }}</b></div>
        </div>

        <div class="actions">
          <button *ngIf="canConfirm(t)" class="btn btn--success" (click)="requestAction('CONFIRMAR', t)">
            Confirmar turno
          </button>

          <button *ngIf="canReprogram(t)" class="btn btn--primary" (click)="requestAction('REPROGRAMAR', t)">
            Reprogramar turno
          </button>

          <button *ngIf="canMarkCompleted(t)" class="btn btn--success" (click)="requestAction('COMPLETAR', t)">
            Marcar asistencia
          </button>

          <button *ngIf="canMarkNoShow(t)" class="btn btn--danger" (click)="requestAction('NO_PRESENTADO', t)">
            No se presentó
          </button>

          <button *ngIf="canCancel(t)" class="btn btn--danger" (click)="requestAction('CANCELAR', t)">
            Cancelar turno
          </button>
        </div>
      </div>
    </div>
  </section>

  <div class="empty-detail" *ngIf="!turnoSeleccionado">
    Seleccioná un turno para ver el detalle.
  </div>
</div>

<app-confirm-modal
  [open]="modalOpen"
  [title]="modalTitle"
  [message]="modalMessage"
  [confirmText]="modalConfirmText"
  [loading]="modalLoading"
  [error]="modalError"
  (confirm)="confirmModal()"
  (cancel)="closeModal()"
></app-confirm-modal>
